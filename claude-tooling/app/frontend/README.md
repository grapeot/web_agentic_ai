# Claude Tooling 前端重构

## 项目概述

该项目是一个基于Claude API的聊天工具，支持工具调用、文件生成等功能。当前代码库需要进行重构，以提高代码可维护性和组织结构。

## 重构计划

我们计划将单一的`main.js`文件拆分为多个功能模块：

```
js/
├── modules/
│   ├── config.js      # 配置设置
│   ├── api.js         # API交互
│   ├── state.js       # 状态管理
│   ├── ui.js          # UI渲染
│   ├── events.js      # 事件处理
│   ├── tools.js       # 工具功能
│   ├── filePreview.js # 文件预览功能
│   └── utils.js       # 辅助函数
├── main.js            # 主入口点
└── tests/
    ├── setup.js       # 测试设置
    └── main.test.js   # 功能测试
```

## 当前进度

- [x] 设置测试基础架构：Jest、JSDOM环境、测试用例、运行脚本
- [x] 创建模块目录结构
- [x] 拆分代码到模块：
  - [x] 创建config.js：配置设置
  - [x] 创建api.js：API交互
  - [x] 创建state.js：状态管理
  - [x] 创建ui.js：UI渲染
  - [x] 创建events.js：事件处理
  - [x] 创建tools.js：工具功能
  - [x] 创建filePreview.js：文件预览
  - [x] 创建utils.js：辅助函数
- [ ] 更新main.js入口点
- [ ] 运行测试验证功能正确性
- [ ] 补充完整文档

## 下一步计划

1. **保持main.js功能不变**：首先确保测试能够通过
2. **逐步替换实现**：在测试通过后，逐步用模块化实现替换原有代码
3. **增量测试**：每完成一部分替换就运行测试确保功能正常

## 测试设置

为确保重构后功能正确性，我们已设置自动化测试：

1. **Jest测试框架** - 用于测试JavaScript代码
2. **JSDOM** - 用于模拟DOM环境
3. **功能测试** - 验证关键功能流程

## 测试与验证

### 运行测试

```bash
# 方法1：使用提供的脚本
./run-tests.sh

# 方法2：手动运行
npm install  # 首次运行时安装依赖
npm test
```

### 主要测试用例

- 应用初始化：验证DOM元素和API调用
- 发送消息：验证用户消息发送和响应显示
- 工具调用：验证工具调用流程和结果处理
- 聊天清除：验证清除聊天功能
- 设置调整：验证设置项更新

## 重构实施步骤

1. **创建模块结构**：首先建立文件夹和空文件
2. **提取共享配置**：创建config.js提取所有配置常量
3. **分离API交互**：将所有API调用移至api.js
4. **实现状态管理**：创建state.js管理应用状态
5. **分离UI渲染**：将DOM操作集中到ui.js
6. **分离工具功能**：将工具相关逻辑移至tools.js
7. **分离事件处理**：将事件监听器和处理逻辑移至events.js
8. **分离文件预览**：将文件预览功能移至filePreview.js
9. **提取辅助函数**：将通用函数提取到utils.js
10. **更新主入口**：更新main.js以导入和初始化模块

每完成一个模块的重构，都会运行测试以确保功能正确性。 